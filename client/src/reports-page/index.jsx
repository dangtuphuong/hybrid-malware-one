import { useNavigate } from "react-router-dom";
import { Typography } from "@mui/material";
import { DataGrid } from "@mui/x-data-grid";
import Paper from "@mui/material/Paper";
import PageLayout from "../components/PageLayout.jsx";
import DataService from "../services/data-service";
import { useEffect, useState } from "react";

const paginationModel = { page: 0, pageSize: 10 };

const columns = [
  { field: "id", headerName: "ID", minWidth: 100 },
  { field: "name", headerName: "Name", minWidth: 500 },
  { field: "created_at", headerName: "Date", minWidth: 300 },
  { field: "created_by", headerName: "User", minWidth: 150 },
];

const ReportsPage = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);
  const [reports, setReports] = useState([]);

  useEffect(() => {
    setLoading(true);
    DataService.getReports()
      .then((res) => {
        setReports(res?.data?.items ?? []);
      })
      .catch((err) => {
        console.log(err);
      })
      .finally(() => setLoading(false));
  }, []);

  return (
    <PageLayout>
      <Typography variant="h5" sx={{ mb: 4, fontWeight: 600 }}>
        All Reports
      </Typography>
      <Paper>
        <DataGrid
          loading={loading}
          autosizeOnMount
          disableColumnMenu
          disableColumnSelector
          disableRowSelectionOnClick
          rows={reports}
          columns={columns}
          initialState={{ pagination: { paginationModel } }}
          pageSizeOptions={[5, 10]}
          sx={{ border: 0 }}
          onRowClick={({ id }) => navigate(`/report/${id}`)}
        />
      </Paper>
    </PageLayout>
  );
};

export default ReportsPage;
