import pandas as pd
import joblib


def predict_from_model(file, separator, feature_columns, model_id):
    # Load models from file
    try:
        models = joblib.load('models_with_ids.pkl')
    except FileNotFoundError:
        raise FileNotFoundError("Models file 'models_with_ids.pkl' not found.")

    # Check if models dictionary is empty
    if not models:
        raise ValueError("No models found in 'models_with_ids.pkl'.")

    # Load the new data
    data = pd.read_csv(file, sep=separator or ',')

    # Drop rows with any missing values in specified feature columns
    data = data.dropna(subset=feature_columns)

    # Prepare the features for prediction
    X_new = data[feature_columns]

    # Check if the specified model_id exists
    if model_id not in models:
        raise ValueError(f"Model ID '{model_id}' not found.")

    # Get the model and predict
    model_info = models[model_id]
    model = model_info['model']
    predictions = model.predict(X_new)

    # Convert predictions to list for easy reading
    result = {
        'model_label': model_info['label'],
        'predictions': predictions.tolist()
    }

    return result
