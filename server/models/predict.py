import pandas as pd
import joblib


def predict_from_models(file, separator, feature_columns):
    # Load models from file
    try:
        models = joblib.load('models_with_ids.pkl')
    except FileNotFoundError:
        raise FileNotFoundError("Models file 'models_with_ids.pkl' not found.")

    # Check if models dictionary is empty
    if not models:
        raise ValueError("No models found in 'models_with_ids.pkl'.")

    # Load the new data
    data = pd.read_csv(file, sep=separator or ',')

    # Drop rows with any missing values
    data = data.dropna(subset=feature_columns)

    # Prepare the features for prediction
    X_new = data[feature_columns]

    # Prepare results for each model
    results = {}

    # Predict using each model
    for model_id, model_info in models.items():
        model = model_info['model']
        predictions = model.predict(X_new)
        # Convert to list for easy reading
        results[model_info['label']] = predictions.tolist()

    return results
